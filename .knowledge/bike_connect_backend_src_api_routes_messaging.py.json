{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints for messaging functionalities in a backend service using FastAPI. It includes routes to list conversations, retrieve messages, and send messages, with database interactions handled via SQLAlchemy. It also contains internal helper functions for participant validation.", "external_files": ["src.api.db", "src.api.deps", "src.api.schemas"], "external_methods": ["get_current_user", "select", "and_", "insert", "select", "session_scope"], "published": ["list_conversations", "get_messages", "send_message"], "classes": [], "methods": [{"name": "None _ensure_participant(db, conversation_id: str, user_id: str)", "description": "Checks if a user is a participant in a specific conversation, raising an HTTP 403 error if not.", "scope": "", "scopeKind": ""}, {"name": "list_conversations(current_user: dict = Depends(get_current_user))", "description": "Retrieves a list of conversations for the current user, including the last message and conversation title.", "scope": "", "scopeKind": ""}, {"name": "get_messages(conversation_id: str, current_user: dict = Depends(get_current_user))", "description": "Fetches and returns all messages within a specified conversation, indicating which messages are sent by the current user.", "scope": "", "scopeKind": ""}, {"name": "send_message(conversation_id: str, req: SendMessageRequest, current_user: dict = Depends(get_current_user))", "description": "Creates and adds a message to a conversation, automatically creating the conversation if it does not exist.", "scope": "", "scopeKind": ""}], "calls": ["select", "and_", "insert", "db.execute", "db.execute", "db.execute", "db.execute", "db.execute", "db.execute", "db.execute"], "search-terms": ["routes_messaging", "conversations", "messages", "Messaging", "APIRouter", "send_message", "list_conversations", "get_messages"], "state": 2, "file_id": 22, "knowledge_revision": 40, "git_revision": "", "ctags": [{"_type": "tag", "name": "_ensure_participant", "path": "/home/kavia/workspace/code-generation/cyclist-connect-325111-325120/bike_connect_backend/src/api/routes_messaging.py", "pattern": "/^def _ensure_participant(db, conversation_id: str, user_id: str) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(db, conversation_id: str, user_id: str)"}, {"_type": "tag", "name": "get_messages", "path": "/home/kavia/workspace/code-generation/cyclist-connect-325111-325120/bike_connect_backend/src/api/routes_messaging.py", "pattern": "/^def get_messages(conversation_id: str, current_user: dict = Depends(get_current_user)):$/", "language": "Python", "kind": "function", "signature": "(conversation_id: str, current_user: dict = Depends(get_current_user))"}, {"_type": "tag", "name": "list_conversations", "path": "/home/kavia/workspace/code-generation/cyclist-connect-325111-325120/bike_connect_backend/src/api/routes_messaging.py", "pattern": "/^def list_conversations(current_user: dict = Depends(get_current_user)):$/", "language": "Python", "kind": "function", "signature": "(current_user: dict = Depends(get_current_user))"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/cyclist-connect-325111-325120/bike_connect_backend/src/api/routes_messaging.py", "pattern": "/^router = APIRouter(tags=[\"Messaging\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "send_message", "path": "/home/kavia/workspace/code-generation/cyclist-connect-325111-325120/bike_connect_backend/src/api/routes_messaging.py", "pattern": "/^def send_message(conversation_id: str, req: SendMessageRequest, current_user: dict = Depends(get/", "language": "Python", "kind": "function", "signature": "(conversation_id: str, req: SendMessageRequest, current_user: dict = Depends(get_current_user))"}], "hash": "8e93d1099cccad88f804d79c700242e6", "format-version": 4, "code-base-name": "bike_connect_backend", "filename": "bike_connect_backend/src/api/routes_messaging.py", "fields": [{"name": "router = APIRouter(tags=[\"Messaging\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"40": ""}]}